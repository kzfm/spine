<!DOCTYPE html>  <html> <head>   <title>spine.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="ajax.html">                 ajax.coffee               </a>                                           <a class="source" href="list.html">                 list.coffee               </a>                                           <a class="source" href="local.html">                 local.coffee               </a>                                           <a class="source" href="manager.html">                 manager.coffee               </a>                                           <a class="source" href="relation.html">                 relation.coffee               </a>                                           <a class="source" href="route.html">                 route.coffee               </a>                                           <a class="source" href="spine.html">                 spine.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               spine.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Events</h1>

<p>クラスじゃなくてオブジェクト</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Events =</span>
  <span class="nv">bind: </span><span class="nf">(ev, callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>空白で分割してイベントの配列にする</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">evs   = </span><span class="nx">ev</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>_callbacksっていう属性を持っていなければ {}</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">calls = </span><span class="nx">@hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_callbacks&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">@_callbacks</span> <span class="o">or=</span> <span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>calls配列にpush</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">evs</span>
      <span class="nx">calls</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">or=</span> <span class="p">[]</span>
      <span class="nx">calls</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>一回のみ実行されるように</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">one: </span><span class="nf">(ev, callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>unbindしてcallbackを実行する関数を渡す</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@bind</span> <span class="nx">ev</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">@unbind</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">)</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>イベント発生</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">trigger: </span><span class="nf">(args...) -&gt;</span>
    <span class="nv">ev = </span><span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>コールバック関数のリストを取得</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">list = </span><span class="nx">@hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;_callbacks&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">@_callbacks</span><span class="o">?</span><span class="p">[</span><span class="nx">ev</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">list</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>リストに入ったコールバックを次々に実行していく</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">callback</span> <span class="k">in</span> <span class="nx">list</span>
      <span class="k">if</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="o">is</span> <span class="kc">false</span>
        <span class="k">break</span>
    <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>unbindする</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">unbind: </span><span class="nf">(ev, callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>ev がなければまっさらにする</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">ev</span>
      <span class="vi">@_callbacks = </span><span class="p">{}</span>
      <span class="k">return</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>対応するイベントのリストを取得</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">list = </span><span class="nx">@_callbacks</span><span class="o">?</span><span class="p">[</span><span class="nx">ev</span><span class="p">]</span>
    <span class="k">return</span> <span class="k">this</span> <span class="nx">unless</span> <span class="nx">list</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>callbackがなければリストを削除</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">callback</span>
      <span class="k">delete</span> <span class="nx">@_callbacks</span><span class="p">[</span><span class="nx">ev</span><span class="p">]</span>
      <span class="k">return</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>リストからコールバックと同じ物を探して削除</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">list</span> <span class="k">when</span> <span class="nx">cb</span> <span class="o">is</span> <span class="nx">callback</span>
      <span class="nv">list = </span><span class="nx">list</span><span class="p">.</span><span class="nx">slice</span><span class="p">()</span>
      <span class="nx">list</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="nx">@_callbacks</span><span class="p">[</span><span class="nx">ev</span><span class="p">]</span> <span class="o">=</span> <span class="nx">list</span>
      <span class="k">break</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h1>Log</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Log =</span>
  <span class="nv">trace: </span><span class="kc">true</span>

  <span class="nv">logPrefix: </span><span class="s1">&#39;(App)&#39;</span>

  <span class="nv">log: </span><span class="nf">(args...) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>traceがfalseだったらやめ</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@trace</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>プレフィクスがあればくっつけてコンソールに出力</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@logPrefix</span> <span class="k">then</span> <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">@logPrefix</span><span class="p">)</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">log</span><span class="o">?</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span>
    <span class="k">this</span>

<span class="nv">moduleKeywords = </span><span class="p">[</span><span class="s1">&#39;included&#39;</span><span class="p">,</span> <span class="s1">&#39;extended&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h1>Module</h1>

<p>最上位
include, extend, proxy, constructorを定義している</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Module</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>引数で与えられたオブジェクトのプロパティをprototypeに取り込む</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@include: </span><span class="nf">(obj) -&gt;</span>
    <span class="k">throw</span><span class="p">(</span><span class="s1">&#39;include(obj) requires obj&#39;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">obj</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">obj</span> <span class="k">when</span> <span class="nx">key</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">moduleKeywords</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>::はprototypeへのアクセス
@:: = this.prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="err">@</span><span class="o">::</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>コールバック</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">included</span><span class="o">?</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">)</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>引数で与えられたオブジェクトのプロパティを拡張する</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@extend: </span><span class="nf">(obj) -&gt;</span>
    <span class="k">throw</span><span class="p">(</span><span class="s1">&#39;extend(obj) requires obj&#39;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">obj</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">obj</span> <span class="k">when</span> <span class="nx">key</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">moduleKeywords</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>コールバック</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">extended</span><span class="o">?</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">)</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>@proxyとproxxyの2つがある理由がわからん</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@proxy: </span><span class="nf">(func) -&gt;</span>
    <span class="o">=&gt;</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>

  <span class="nv">proxy: </span><span class="nf">(func) -&gt;</span>
    <span class="o">=&gt;</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>initが定義されていれば実行する</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    <span class="nx">@init</span><span class="o">?</span><span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h1>Model</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Model</span> <span class="k">extends</span> <span class="nx">Module</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <pre><code>__extends = function(child, parent) {
  for (var key in parent) {
    if (__hasProp.call(parent, key)) child[key] = parent[key];
}
function ctor() { this.constructor = child; }
ctor.prototype = parent.prototype;
child.prototype = new ctor;
child.__super__ = parent.prototype; return child; },
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Eventsを拡張</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">@extend</span> <span class="nx">Events</span>

  <span class="vi">@records: </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>cidでレコードを管理する</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@crecords: </span><span class="p">{}</span>
  <span class="vi">@attributes: </span><span class="p">[]</span>

  <span class="vi">@configure: </span><span class="nf">(name, attributes...) -&gt;</span>
    <span class="vi">@className  = </span><span class="nx">name</span>
    <span class="vi">@records    = </span><span class="p">{}</span>
    <span class="vi">@crecords   = </span><span class="p">{}</span>
    <span class="vi">@attributes = </span><span class="nx">attributes</span> <span class="k">if</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">@attributes</span> <span class="o">and=</span> <span class="nx">makeArray</span><span class="p">(</span><span class="nx">@attributes</span><span class="p">)</span>
    <span class="nx">@attributes</span> <span class="o">or=</span>  <span class="p">[]</span>
    <span class="nx">@unbind</span><span class="p">()</span>
    <span class="k">this</span>

  <span class="vi">@toString: </span><span class="o">-&gt;</span> <span class="s2">&quot;#{@className}(#{@attributes.join(&quot;</span><span class="p">,</span> <span class="s2">&quot;)})&quot;</span>

  <span class="vi">@find: </span><span class="nf">(id) -&gt;</span>
    <span class="nv">record = </span><span class="nx">@records</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>レコードが見つからなくて、文字列がcidに一致していればcidで探す</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">!</span><span class="nx">record</span> <span class="o">and</span> <span class="p">(</span><span class="s2">&quot;#{id}&quot;</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/c-\d+/</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">@findCID</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="k">throw</span><span class="p">(</span><span class="s1">&#39;Unknown record&#39;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">record</span>
    <span class="nx">record</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
<span class="err">　</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>cidで探す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@findCID: </span><span class="nf">(cid) -&gt;</span>
    <span class="nv">record = </span><span class="nx">@crecords</span><span class="p">[</span><span class="nx">cid</span><span class="p">]</span>
    <span class="k">throw</span><span class="p">(</span><span class="s1">&#39;Unknown record&#39;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">record</span>
    <span class="nx">record</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>在るか？</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@exists: </span><span class="nf">(id) -&gt;</span>
    <span class="k">try</span>
      <span class="k">return</span> <span class="nx">@find</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="k">catch</span> <span class="nx">e</span>
      <span class="k">return</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>再読み込みしたらrefreshトリガーを発生させる</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@refresh: </span><span class="nf">(values, options = {}) -&gt;</span>
    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">clear</span>
      <span class="vi">@records  = </span><span class="p">{}</span>
      <span class="vi">@crecords = </span><span class="p">{}</span>

    <span class="nv">records = </span><span class="nx">@fromJSON</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span>
    <span class="nv">records = </span><span class="p">[</span><span class="nx">records</span><span class="p">]</span> <span class="nx">unless</span> <span class="nx">isArray</span><span class="p">(</span><span class="nx">records</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">record</span> <span class="k">in</span> <span class="nx">records</span>
      <span class="nx">record</span><span class="p">.</span><span class="nx">id</span>           <span class="o">or=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">cid</span>
      <span class="nx">@records</span><span class="p">[</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>   <span class="o">=</span> <span class="nx">record</span>
      <span class="nx">@crecords</span><span class="p">[</span><span class="nx">record</span><span class="p">.</span><span class="nx">cid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">record</span>

    <span class="nx">@resetIdCounter</span><span class="p">()</span>

    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">,</span> <span class="o">not</span> <span class="nx">options</span><span class="p">.</span><span class="nx">clear</span> <span class="o">and</span> <span class="nx">@cloneArray</span><span class="p">(</span><span class="nx">records</span><span class="p">))</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>callbackで選択する</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@select: </span><span class="nf">(callback) -&gt;</span>
    <span class="nv">result = </span><span class="p">(</span><span class="nx">record</span> <span class="k">for</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">record</span> <span class="k">of</span> <span class="nx">@records</span> <span class="k">when</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">record</span><span class="p">))</span>
    <span class="nx">@cloneArray</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>属性検索</p>

<p>一致した最初のレコードを返す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@findByAttribute: </span><span class="nf">(name, value) -&gt;</span>
    <span class="k">for</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">record</span> <span class="k">of</span> <span class="nx">@records</span>
      <span class="k">if</span> <span class="nx">record</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">is</span> <span class="nx">value</span>
        <span class="k">return</span> <span class="nx">record</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
    <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>マッチするすべてのレコードを返す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@findAllByAttribute: </span><span class="nf">(name, value) -&gt;</span>
    <span class="nx">@select</span> <span class="nf">(item) -&gt;</span>
      <span class="nx">item</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">is</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>全てにコールバック関数を適用する</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@each: </span><span class="nf">(callback) -&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">@records</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">clone</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>全てを返す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@all: </span><span class="o">-&gt;</span>
    <span class="nx">@cloneArray</span><span class="p">(</span><span class="nx">@recordsValues</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>最初のレコードを返す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@first: </span><span class="o">-&gt;</span>
    <span class="nv">record = </span><span class="nx">@recordsValues</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">record</span><span class="o">?</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>最後のレコードを返す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@last: </span><span class="o">-&gt;</span>
    <span class="nv">values = </span><span class="nx">@recordsValues</span><span class="p">()</span>
    <span class="nv">record = </span><span class="nx">values</span><span class="p">[</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="nx">record</span><span class="o">?</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>数える</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@count: </span><span class="o">-&gt;</span>
    <span class="nx">@recordsValues</span><span class="p">().</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>全部消す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@deleteAll: </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">@records</span>
      <span class="k">delete</span> <span class="nx">@records</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>destroyは内部メソッド</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@destroyAll: </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">@records</span>
      <span class="nx">@records</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">destroy</span><span class="p">()</span>

  <span class="vi">@update: </span><span class="nf">(id, atts, options) -&gt;</span>
    <span class="nx">@find</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">updateAttributes</span><span class="p">(</span><span class="nx">atts</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

  <span class="vi">@create: </span><span class="nf">(atts, options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>これがよくわからん attsって実際なに？</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">record = </span><span class="k">new</span> <span class="err">@</span><span class="p">(</span><span class="nx">atts</span><span class="p">)</span>
    <span class="nx">record</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>destroyは内部メソッド</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@destroy: </span><span class="nf">(id, options) -&gt;</span>
    <span class="nx">@find</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>関数だったらbind,パラメーターだったらトリガー</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@change: </span><span class="nf">(callbackOrParams) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">callbackOrParams</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
      <span class="nx">@bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">callbackOrParams</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">callbackOrParams</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>関数だったらbind,パラメーターだったらトリガー</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@fetch: </span><span class="nf">(callbackOrParams) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">callbackOrParams</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
      <span class="nx">@bind</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span> <span class="nx">callbackOrParams</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;fetch&#39;</span><span class="p">,</span> <span class="nx">callbackOrParams</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>配列を返す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@toJSON: </span><span class="o">-&gt;</span>
    <span class="nx">@recordsValues</span><span class="p">()</span>

  <span class="vi">@fromJSON: </span><span class="nf">(objects) -&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">objects</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">objects</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span>
      <span class="nv">objects = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">objects</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">isArray</span><span class="p">(</span><span class="nx">objects</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>何をnewしているのか？</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">(</span><span class="k">new</span> <span class="err">@</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">objects</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">new</span> <span class="err">@</span><span class="p">(</span><span class="nx">objects</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>ちょっとわからん</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@fromForm: </span><span class="o">-&gt;</span>
    <span class="p">(</span><span class="k">new</span> <span class="k">this</span><span class="p">).</span><span class="nx">fromForm</span><span class="p">(</span><span class="nx">arguments</span><span class="p">...)</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <h3>Private</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>valueを配列にして戻す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@recordsValues: </span><span class="o">-&gt;</span>
    <span class="nv">result = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">@records</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
    <span class="nx">result</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>clone</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@cloneArray: </span><span class="nf">(array) -&gt;</span>
    <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span> <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">array</span><span class="p">)</span>

  <span class="vi">@idCounter: </span><span class="mi">0</span>

  <span class="vi">@resetIdCounter: </span><span class="o">-&gt;</span>
    <span class="nv">ids        = </span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span> <span class="k">for</span> <span class="nx">model</span> <span class="k">in</span> <span class="nx">@all</span><span class="p">()).</span><span class="nx">sort</span><span class="p">(</span><span class="nf">(a, b) -&gt;</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">)</span>
    <span class="nv">lastID     = </span><span class="nx">ids</span><span class="p">[</span><span class="nx">ids</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="nv">lastID     = </span><span class="nx">lastID</span><span class="o">?</span><span class="p">.</span><span class="nx">replace</span><span class="o">?</span><span class="p">(</span><span class="sr">/^c-/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">or</span> <span class="nx">lastID</span>
    <span class="nv">lastID     = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">lastID</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="vi">@idCounter = </span><span class="p">(</span><span class="nx">lastID</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">or</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>uidってどこで使うの？</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@uid: </span><span class="nf">(prefix = &#39;&#39;) -&gt;</span>
    <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">@idCounter</span><span class="o">++</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <h3>Instance</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(atts) -&gt;</span>
    <span class="k">super</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>load: (atts) ->
     for key, value of atts
       if typeof @[key] is 'function'
         @<a href="value">key</a>
       else
         @[key] = value
     this</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@load</span> <span class="nx">atts</span> <span class="k">if</span> <span class="nx">atts</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>cidが設定されてなければuidメソッドで設定
ところでなんで@constructorのメソッドなの？</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@cid</span> <span class="o">or=</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">uid</span><span class="p">(</span><span class="s1">&#39;c-&#39;</span><span class="p">)</span>

  <span class="nv">isNew: </span><span class="o">-&gt;</span>
    <span class="o">not</span> <span class="nx">@exists</span><span class="p">()</span>

  <span class="nv">isValid: </span><span class="o">-&gt;</span>
    <span class="o">not</span> <span class="nx">@validate</span><span class="p">()</span>

  <span class="nv">validate: </span><span class="o">-&gt;</span>

  <span class="nv">load: </span><span class="nf">(atts) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>関数だったらvalを引数にして実行。それ以外だったら代入</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">atts</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
        <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">](</span><span class="nx">value</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="k">this</span>

  <span class="nv">attributes: </span><span class="o">-&gt;</span>
    <span class="nv">result = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>@constructor.attributesの属性のうちthisの属性を選択</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">attributes</span> <span class="k">when</span> <span class="nx">key</span> <span class="k">of</span> <span class="k">this</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
        <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]()</span>
      <span class="k">else</span>
        <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="nv">result.id = </span><span class="nx">@id</span> <span class="k">if</span> <span class="nx">@id</span>
    <span class="nx">result</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>等しいとは以下の3つの条件を満たす</p>

<ul>
<li>recのコンストラクタが等しい</li>
<li>cidが等しい</li>
<li>idが等しい</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">eql: </span><span class="nf">(rec) -&gt;</span>
    <span class="o">!!</span><span class="p">(</span><span class="nx">rec</span> <span class="o">and</span> <span class="nx">rec</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">is</span> <span class="nx">@constructor</span> <span class="o">and</span>
        <span class="p">(</span><span class="nx">rec</span><span class="p">.</span><span class="nx">cid</span> <span class="o">is</span> <span class="nx">@cid</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">rec</span><span class="p">.</span><span class="nx">id</span> <span class="o">and</span> <span class="nx">rec</span><span class="p">.</span><span class="nx">id</span> <span class="o">is</span> <span class="nx">@id</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>saveするとerror, beforeSave, saveのトリガー発生</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">save: </span><span class="nf">(options = {}) -&gt;</span>
    <span class="nx">unless</span> <span class="nx">options</span><span class="p">.</span><span class="nx">validate</span> <span class="o">is</span> <span class="kc">false</span>
      <span class="nv">error = </span><span class="nx">@validate</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">error</span>
        <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span>

    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;beforeSave&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>新しければcreateそうでなければupdate</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">record = </span><span class="k">if</span> <span class="nx">@isNew</span><span class="p">()</span> <span class="k">then</span> <span class="nx">@create</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@update</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nx">record</span>

  <span class="nv">updateAttribute: </span><span class="nf">(name, value, options) -&gt;</span>
    <span class="err">@</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="nx">@save</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

  <span class="nv">updateAttributes: </span><span class="nf">(atts, options) -&gt;</span>
    <span class="nx">@load</span><span class="p">(</span><span class="nx">atts</span><span class="p">)</span>
    <span class="nx">@save</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

  <span class="nv">changeID: </span><span class="nf">(id) -&gt;</span>
    <span class="nv">records = </span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">records</span>
    <span class="nx">records</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">records</span><span class="p">[</span><span class="nx">@id</span><span class="p">]</span>
    <span class="k">delete</span> <span class="nx">records</span><span class="p">[</span><span class="nx">@id</span><span class="p">]</span>
    <span class="vi">@id = </span><span class="nx">id</span>
    <span class="nx">@save</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>deleteする前とあとに計3つのトリガー</p>

<p>recordsとcrecordsが削除される</p>

<p>ついでにunbindもされる</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroy: </span><span class="nf">(options = {}) -&gt;</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;beforeDestroy&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="k">delete</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">records</span><span class="p">[</span><span class="nx">@id</span><span class="p">]</span>
    <span class="k">delete</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">crecords</span><span class="p">[</span><span class="nx">@cid</span><span class="p">]</span>
    <span class="vi">@destroyed = </span><span class="kc">true</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nx">@unbind</span><span class="p">()</span>
    <span class="k">this</span>

  <span class="nv">dup: </span><span class="nf">(newRecord) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>これがわからん</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="k">new</span> <span class="nx">@constructor</span><span class="p">(</span><span class="nx">@attributes</span><span class="p">())</span>
    <span class="k">if</span> <span class="nx">newRecord</span> <span class="o">is</span> <span class="kc">false</span>
      <span class="nv">result.cid = </span><span class="nx">@cid</span>
    <span class="k">else</span>
      <span class="k">delete</span> <span class="nx">result</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">result</span>

  <span class="nv">clone: </span><span class="o">-&gt;</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="err">@</span><span class="p">)</span>

  <span class="nv">reload: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="k">this</span> <span class="k">if</span> <span class="nx">@isNew</span><span class="p">()</span>
    <span class="nv">original = </span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">@id</span><span class="p">)</span>
    <span class="nx">@load</span><span class="p">(</span><span class="nx">original</span><span class="p">.</span><span class="nx">attributes</span><span class="p">())</span>
    <span class="nx">original</span>

  <span class="nv">toJSON: </span><span class="o">-&gt;</span>
    <span class="nx">@attributes</span><span class="p">()</span>

  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="s2">&quot;&lt;#{@constructor.className} (#{JSON.stringify(@)})&gt;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>これはどこで使うんだ？</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fromForm: </span><span class="nf">(form) -&gt;</span>
    <span class="nv">result = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">).</span><span class="nx">serializeArray</span><span class="p">()</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">value</span>
    <span class="nx">@load</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>存在するとは
idが存在して@constructor.recordsにあること</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">exists: </span><span class="o">-&gt;</span>
    <span class="nx">@id</span> <span class="o">&amp;&amp;</span> <span class="nx">@id</span> <span class="k">of</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">records</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <h3>Private</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>前後にトリガー
クローンを返す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">update: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;beforeUpdate&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nv">records = </span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">records</span>
    <span class="nx">records</span><span class="p">[</span><span class="nx">@id</span><span class="p">].</span><span class="nx">load</span> <span class="nx">@attributes</span><span class="p">()</span>
    <span class="nv">clone = </span><span class="nx">records</span><span class="p">[</span><span class="nx">@id</span><span class="p">].</span><span class="nx">clone</span><span class="p">()</span>
    <span class="nx">clone</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nx">clone</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nx">clone</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>前後にトリガー
クローンを返す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">create: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;beforeCreate&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="vi">@id          = </span><span class="nx">@cid</span> <span class="nx">unless</span> <span class="nx">@id</span>

    <span class="nv">record       = </span><span class="nx">@dup</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="nx">@constructor</span><span class="p">.</span><span class="nx">records</span><span class="p">[</span><span class="nx">@id</span><span class="p">]</span>   <span class="o">=</span> <span class="nx">record</span>
    <span class="nx">@constructor</span><span class="p">.</span><span class="nx">crecords</span><span class="p">[</span><span class="nx">@cid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">record</span>

    <span class="nv">clone        = </span><span class="nx">record</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
    <span class="nx">clone</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nx">clone</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nx">clone</span>

  <span class="nv">bind: </span><span class="nf">(events, callback) -&gt;</span>
    <span class="nx">@constructor</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">events</span><span class="p">,</span> <span class="nv">binder = </span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">record</span> <span class="o">&amp;&amp;</span> <span class="nx">@eql</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span>
        <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
    <span class="nx">@constructor</span><span class="p">.</span><span class="nx">bind</span> <span class="s1">&#39;unbind&#39;</span><span class="p">,</span> <span class="nv">unbinder = </span><span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">record</span> <span class="o">&amp;&amp;</span> <span class="nx">@eql</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span>
        <span class="nx">@constructor</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">binder</span><span class="p">)</span>
        <span class="nx">@constructor</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;unbind&#39;</span><span class="p">,</span> <span class="nx">unbinder</span><span class="p">)</span>
    <span class="nx">binder</span>

  <span class="nv">one: </span><span class="nf">(events, callback) -&gt;</span>
    <span class="nv">binder = </span><span class="nx">@bind</span> <span class="nx">events</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nx">@constructor</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">binder</span><span class="p">)</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">)</span>

  <span class="nv">trigger: </span><span class="nf">(args...) -&gt;</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="err">@</span><span class="p">)</span>
    <span class="nx">@constructor</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span>

  <span class="nv">unbind: </span><span class="o">-&gt;</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;unbind&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <h1>Controller</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Controller</span> <span class="k">extends</span> <span class="nx">Module</span>
  <span class="nx">@include</span> <span class="nx">Events</span>
  <span class="nx">@include</span> <span class="nx">Log</span>

  <span class="nv">eventSplitter: </span><span class="sr">/^(\S+)\s*(.*)$/</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>デフォルトのタグ</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tag: </span><span class="s1">&#39;div&#39;</span>

  <span class="nv">constructor: </span><span class="nf">(options) -&gt;</span>
    <span class="vi">@options = </span><span class="nx">options</span>

    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">@options</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>elが設定されてない場合にはdivが使われる</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@el = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">@tag</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">@el</span>
    <span class="vi">@el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">@el</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>className,attributesがあれば@elに追加される</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">@className</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@className</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">@attributes</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@attributes</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>なんのために用意されているの？</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@release</span> <span class="o">-&gt;</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>わからん</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@events = </span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">events</span> <span class="nx">unless</span> <span class="nx">@events</span>
    <span class="vi">@elements = </span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">elements</span> <span class="nx">unless</span> <span class="nx">@elements</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>わからん</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@delegateEvents</span><span class="p">(</span><span class="nx">@events</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@events</span>
    <span class="nx">@refreshElements</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@elements</span>

    <span class="k">super</span>

  <span class="nv">release: </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>callbackに関数が与えられたらbindでそうじゃなかったらトリガー</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
      <span class="nx">@bind</span> <span class="s1">&#39;release&#39;</span><span class="p">,</span> <span class="nx">callback</span>
    <span class="k">else</span>
      <span class="nx">@trigger</span> <span class="s1">&#39;release&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>@el内を探す</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">$: </span><span class="nf">(selector) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">@el</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>イベントの委譲</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">delegateEvents: </span><span class="nf">(events) -&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">method</span> <span class="k">of</span> <span class="nx">events</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>methodが関数ではない場合、proxy</p>

<p>　 @proxy: (func) ->
    => func.apply(@, arguments)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">unless</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
        <span class="nv">method = </span><span class="nx">@proxy</span><span class="p">(</span><span class="err">@</span><span class="p">[</span><span class="nx">method</span><span class="p">])</span>

      <span class="nv">match      = </span><span class="nx">key</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">@eventSplitter</span><span class="p">)</span>
      <span class="nv">eventName  = </span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="nv">selector   = </span><span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>セレクタが指定されていなければイベントにメソッドをバインドする</p>

<p>セレクタが指定されていれば、委譲する
delegateメソッドは<a href="http://api.jquery.com/delegate/">jQueryのメソッド</a></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">selector</span> <span class="o">is</span> <span class="s1">&#39;&#39;</span>
        <span class="nx">@el</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">@el</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>リフレッシュ</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">refreshElements: </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">@elements</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@$</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>関数の実行時間を遅らせる</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">delay: </span><span class="nf">(func, timeout) -&gt;</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">@proxy</span><span class="p">(</span><span class="nx">func</span><span class="p">),</span> <span class="nx">timeout</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>htmlを出力</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">html: </span><span class="nf">(element) -&gt;</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">el</span> <span class="o">or</span> <span class="nx">element</span><span class="p">)</span>
    <span class="nx">@refreshElements</span><span class="p">()</span>
    <span class="nx">@el</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <h3>jQueryのメソッドを拡張してるだけ</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">append: </span><span class="nf">(elements...) -&gt;</span>
    <span class="nv">elements = </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">el</span> <span class="o">or</span> <span class="nx">e</span> <span class="k">for</span> <span class="nx">e</span> <span class="k">in</span> <span class="nx">elements</span><span class="p">)</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">elements</span><span class="p">...)</span>
    <span class="nx">@refreshElements</span><span class="p">()</span>
    <span class="nx">@el</span>

  <span class="nv">appendTo: </span><span class="nf">(element) -&gt;</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">el</span> <span class="o">or</span> <span class="nx">element</span><span class="p">)</span>
    <span class="nx">@refreshElements</span><span class="p">()</span>
    <span class="nx">@el</span>

  <span class="nv">prepend: </span><span class="nf">(elements...) -&gt;</span>
    <span class="nv">elements = </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">el</span> <span class="o">or</span> <span class="nx">e</span> <span class="k">for</span> <span class="nx">e</span> <span class="k">in</span> <span class="nx">elements</span><span class="p">)</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">elements</span><span class="p">...)</span>
    <span class="nx">@refreshElements</span><span class="p">()</span>
    <span class="nx">@el</span>

  <span class="nv">replace: </span><span class="nf">(element) -&gt;</span>
    <span class="p">[</span><span class="nx">previous</span><span class="p">,</span> <span class="nx">@el</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">@el</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">el</span> <span class="o">or</span> <span class="nx">element</span><span class="p">)]</span>
    <span class="nx">previous</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">@el</span><span class="p">)</span>
    <span class="nx">@delegateEvents</span><span class="p">(</span><span class="nx">@events</span><span class="p">)</span>
    <span class="nx">@refreshElements</span><span class="p">()</span>
    <span class="nx">@el</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <h1>Utilities &amp; Shims</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$ = </span><span class="nb">window</span><span class="o">?</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">or</span> <span class="nb">window</span><span class="o">?</span><span class="p">.</span><span class="nx">Zepto</span> <span class="o">or</span> <span class="nf">(element) -&gt;</span> <span class="nx">element</span>

<span class="nx">unless</span> <span class="k">typeof</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nv">create = </span><span class="nf">(o) -&gt;</span>
    <span class="nv">Func = </span><span class="o">-&gt;</span>
    <span class="nv">Func.prototype = </span><span class="nx">o</span>
    <span class="k">new</span> <span class="nx">Func</span><span class="p">()</span>

<span class="nv">isArray = </span><span class="nf">(value) -&gt;</span>
  <span class="nb">Object</span><span class="o">::</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">is</span> <span class="s1">&#39;[object Array]&#39;</span>

<span class="nv">isBlank = </span><span class="nf">(value) -&gt;</span>
  <span class="k">return</span> <span class="kc">true</span> <span class="nx">unless</span> <span class="nx">value</span>
  <span class="k">return</span> <span class="kc">false</span> <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">value</span>
  <span class="kc">true</span>

<span class="nv">makeArray = </span><span class="nf">(args) -&gt;</span>
  <span class="nb">Array</span><span class="o">::</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <h1>Globals</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Spine = </span><span class="vi">@Spine   = </span><span class="p">{}</span>
<span class="nx">module</span><span class="o">?</span><span class="p">.</span><span class="nv">exports  = </span><span class="nx">Spine</span>

<span class="nv">Spine.version    = </span><span class="s1">&#39;1.0.6&#39;</span>
<span class="nv">Spine.isArray    = </span><span class="nx">isArray</span>
<span class="nv">Spine.isBlank    = </span><span class="nx">isBlank</span>
<span class="nx">Spine</span><span class="p">.</span><span class="nv">$          = </span><span class="nx">$</span>
<span class="nv">Spine.Events     = </span><span class="nx">Events</span>
<span class="nv">Spine.Log        = </span><span class="nx">Log</span>
<span class="nv">Spine.Module     = </span><span class="nx">Module</span>
<span class="nv">Spine.Controller = </span><span class="nx">Controller</span>
<span class="nv">Spine.Model      = </span><span class="nx">Model</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <h1>Global events</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Module</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Spine</span><span class="p">,</span> <span class="nx">Events</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <h1>JavaScript compatability</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Module.create = Module.sub =</span>
  <span class="nv">Controller.create = Controller.sub =</span>
    <span class="nv">Model.sub = </span><span class="nf">(instances, statics) -&gt;</span>
      <span class="k">class</span> <span class="nx">result</span> <span class="k">extends</span> <span class="k">this</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">instances</span><span class="p">)</span> <span class="k">if</span> <span class="nx">instances</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">statics</span><span class="p">)</span> <span class="k">if</span> <span class="nx">statics</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">unbind</span><span class="o">?</span><span class="p">()</span>
      <span class="nx">result</span>

<span class="nv">Model.setup = </span><span class="nf">(name, attributes = []) -&gt;</span>
  <span class="k">class</span> <span class="nx">Instance</span> <span class="k">extends</span> <span class="k">this</span>
  <span class="nx">Instance</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">...)</span>
  <span class="nx">Instance</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>なにこれ？</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Module.init = Controller.init = Model.init = </span><span class="nf">(a1, a2, a3, a4, a5) -&gt;</span>
  <span class="k">new</span> <span class="k">this</span><span class="p">(</span><span class="nx">a1</span><span class="p">,</span> <span class="nx">a2</span><span class="p">,</span> <span class="nx">a3</span><span class="p">,</span> <span class="nx">a4</span><span class="p">,</span> <span class="nx">a5</span><span class="p">)</span>

<span class="nv">Spine.Class = </span><span class="nx">Module</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 